# Pentesting Fundamentals
## Ethics
A penetration test is an `authorised audit` of a computer system's security and defences as agreed by the owners of the systems. The legality of penetration is pretty clear-cut in this sense; anything that falls outside of this agreement is deemed unauthorised.

Before a penetration test starts, a formal discussion occurs between the penetration tester and the system owner. Various tools, techniques, and systems to be tested are agreed on. This discussion `forms the scope of the penetration testing agreement` and will determine the course the penetration test takes.

| Hat Category | Description | Example |
|-|-|-|
| White Hat |	These hackers are considered the "good people". They remain within the law and use their skills to benefit others. | A penetration tester performing an authorised engagement on a company. |
| Grey Hat |	These people use their skills to benefit others often; however, they do not respect/follow the law or ethical standards at all times. |	Someone taking down a scamming site without an agreement from the site owners to do so. |
| Black Hat |	These people are criminals and often seek to damage organisations or gain some form of financial benefit at the cost of others. | Ransomware authors infect devices with malicious code and hold data for ransom. |

### Rules of Engagement (ROE)
The `ROE` is a document that is created at the initial stages of a penetration testing engagement. This document consists of three main sections:

| Section | Description |
|-|-|
| Permission | Gives explicit permission for the engagement to be carried out. This permission is essential to legally protect individuals and organisations for the activities they carry out. |
| Test Scope | Will annotate specific targets to which the engagement should apply. For example, the penetration test may only apply to certain servers or applications but not the entire network. |
| Rules | Will define exactly the techniques that are permitted during the engagement. For example, the rules may specifically state that techniques such as phishing attacks are prohibited, but MITM (Man-in-the-Middle) attacks are okay. |

## Methodologies
1. Information gathering
2. Enumeration / Scanning
3. Exploitation
4. Privilege escalation
5. Post-exploitation

### OSSTMM
The Open Source Security Testing Methodology Manual provides a detailed framework of testing strategies for systems, software, applications, communications and the human aspect of cybersecurity.

### OWASP
The "Open Web Application Security Project" framework is a community-driven and frequently updated framework used solely to test the security of web applications and services.

### NIST Cybersecurity Framework 1.1
The NIST Cybersecurity Framework is a popular framework used to improve an organisations cybersecurity standards and manage the risk of cyber threats. This framework is a bit of an honourable mention because of its popularity and detail.

The framework provides guidelines on security controls & benchmarks for success for organisations from critical infrastructure (power plants, etc.) all through to commercial.  There is a limited section on a standard guideline for the methodology a penetration tester should take.

### NCSC CAF
The Cyber Assessment Framework (CAF) is an extensive framework of fourteen principles used to assess the risk of various cyber threats and an organisation's defences against these.

## Types of testing "boxes"
| Box type | Description |
|-|-|
| Black box | High-level process where the tester is `not given any information` about the inner workings of the application or service. |
| Grey box | The combination of both black-box and white-box testing processes. The tester will have some `limited knowledge` of the internal components of the application or piece of software. |
| White box | Usually done by a software developer who knows programming and application logic. The tester will have `full knowledge` of the application and its expected behaviour and is much more time consuming than black-box testing. |

### Advanced Persistent Threats and why Regular Pentesting is not Enough
While the conventional security engagements we have mentioned cover the finding of most technical vulnerabilities, there are limitations on such processes and the extent to which they can effectively prepare a company against a real attacker. Such limitations include:
- Time constraints
- Budget
- Limited scope
- Non-disruptive
- Heavy IT focus

As a consequence, some aspects of penetration tests might significantly differ from a real attack, like:
- Penetration tests are LOUD: Usually, pentesters won't put much effort into trying to go undetected. Unlike real attackers, they don't mind being easy to detect.
- Non-technical attack vectors might be overlooked: Attacks based on `social engineering` or physical intrusions are usually not included in what is tested.
- Relaxation of security mechanisms: While doing a regular penetration test, some security mechanisms might be temporarily disabled or relaxed for the pentesting team in favor of efficiency.

On the other hand, real attackers won't follow an ethical code and are mostly unrestricted in their actions. Nowadays, the most prominent threat actors are known as `Advanced Persistent Threats (APT)`, which are highly skilled groups of attackers, usually sponsored by nations or organised criminal groups.

## Red team engagements
To keep up with the emerging threats, red team engagements were designed to shift the focus from regular penetration tests into a process that allows us to clearly see our defensive team's capabilities at `detecting` and `responding` to a real threat actor. They don't replace traditional penetration tests, but complement them by focusing on detection and response rather than prevention.

Red teaming is a term borrowed from the military. In military exercises, a group would take the role of a `red team` to simulate attack techniques to test the reaction capabilities of a defending team, generally known as `blue team`, against known adversary strategies. Translated into the world of cybersecurity, red team engagements consist of emulating a real threat actor's `Tactics, Techniques and Procedures (TTPs)` so that we can measure how well our blue team responds to them and ultimately improve any security controls in place.

Every red team engagement will start by defining clear goals, often referenced as `crown jewels` or `flags`, ranging from compromising a given critical host to stealing some sensitive information from the target.

Red team engagements also improve on regular penetration tests by considering several attack surfaces:

- Technical Infrastructure: Like in a regular penetration test, a red team will try to uncover technical vulnerabilities, with a much `higher emphasis on stealth and evasion`.
- Social Engineering: `Targeting people` through phishing campaigns, phone calls or social media to `trick them into revealing information` that should be private.
- Physical Intrusion: Using techniques like `lockpicking`, `RFID cloning`, exploiting weaknesses in electronic access control devices to access restricted areas of facilities.

Depending on the resources available, the red team exercise can be run in several ways:

- Full Engagement: Simulate an attacker's full workflow, from initial compromise until final goals have been achieved.
- Assumed Breach: Start by assuming the attacker has already gained control over some assets, and try to achieve the goals from there. As an example, the red team could receive access to some user's credentials or even a workstation in the internal network.
- Table-top Exercise:  An over the table simulation where scenarios are discussed between the red and blue teams to evaluate how they would theoretically respond to certain threats. Ideal for situations where doing live simulations might be complicated.

## Teams and functions of an engagement
There are several factors and people involved within a red team engagement. Everyone will have their mindset and methodology to approach the engagement personnel.

| Teams | [Definitions](https://redteam.guide/docs/definitions/) |
|-|-|
| Red cell | A red cell is the component that makes up the `offensive portion` of a red team engagement that simulates a given target's strategic and tactical responses. |
| Blue cell | The blue cell is the opposite side of red. It includes all the components defending a target network. The blue cell is typically comprised of `blue team members, defenders, internal staff, and an organisation's management`. |
| White cell | Serves as `referee` between red cell activities and blue cell responses `during an engagement`. Controls the engagement environment/network. `Monitors adherence to the ROE`. `Coordinates activities` required to achieve engagement goals. Correlates red cell activities with defensive actions. Ensures the engagement is conducted without bias to either side. |

These teams or cells can be broken down further into an engagement hierarchy.

![Team cells](/Img/TeamCells.png)

| Role | Purpose |
|-|-|
| Red Team Lead | `Plans and organises` engagements at a high levelâ€”delegates, assistant lead, and operators engagement assignments. |
| Red Team Assistant Lead | Assists the team lead in `overseeing engagement` operations and operators. Can also assist in writing engagement plans and documentation if needed. |
| Red Team Operator | `Executes` assignments delegated by team leads. Interpret and analyse engagement plans from team leads. |

## Engagement structure
Structures usually follow a `kill chain` of sorts, which is a military concept that identifies the structure of an attack. In this case we'll look at the common `Lockheed Martin Cyber Kill Chain`.

1. Recon
2. Weaponisation
3. Delivery
4. Exploitation
5. Installation
6. Command & control
7. Actions on objectives